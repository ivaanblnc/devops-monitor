<div class="servers">
  <!-- Header -->
  <div class="servers__header">
    <h1>Servers</h1>
    <button class="servers__btn-add" (click)="openAddModal()">+ Add Server</button>
  </div>

  <!-- Controls -->
  <div class="servers__controls">
    <input
      type="text"
      class="servers__search"
      placeholder="Search servers..."
      [(ngModel)]="searchTerm"
      (input)="onSearchChange()"
      autocomplete="off" />

    <select
      class="servers__filter"
      [(ngModel)]="selectedStatus"
      (change)="onFilterChange()">
      <option value="">All Status</option>
      <option value="online">Online</option>
      <option value="warning">Warning</option>
      <option value="offline">Offline</option>
    </select>

    <select
      class="servers__sort"
      [(ngModel)]="sortBy"
      (change)="onSortChange()">
      <option value="name">Sort by Name</option>
      <option value="cpu">Sort by CPU</option>
      <option value="memory">Sort by Memory</option>
      <option value="status">Sort by Status</option>
    </select>
  </div>

  <!-- Table -->
  <div class="servers__table-wrapper">
    <table class="servers__table">
      <thead class="servers__thead">
        <tr>
          <th>Name</th>
          <th>Status</th>
          <th>CPU</th>
          <th>Memory</th>
          <th>Disk</th>
          <th>Uptime</th>
          <th>Location</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody class="servers__tbody">
        @for (server of paginatedServers(); track server.id) {
          <tr class="servers__row" [class.servers__row--warning]="server.status === 'warning'"
            [class.servers__row--offline]="server.status === 'offline'">
            <td class="servers__cell-name">
              <a routerLink="/servers/{{ server.id }}" class="servers__link">
                {{ server.name }}
              </a>
            </td>
            <td class="servers__cell-status">
              <span class="servers__status" [ngClass]="'servers__status--' + server.status">
                {{ server.status | uppercase }}
              </span>
            </td>
            <td class="servers__cell-metric">
              <div class="servers__progress">
                <div class="servers__progress-bar" [style.width.%]="server.cpu"
                  [ngClass]="{ 'servers__progress-bar--warning': server.cpu > 70, 'servers__progress-bar--error': server.cpu > 85 }">
                </div>
              </div>
              {{ server.cpu | number: '1.0-0' }}%
            </td>
            <td class="servers__cell-metric">
              <div class="servers__progress">
                <div class="servers__progress-bar" [style.width.%]="server.memory"
                  [ngClass]="{ 'servers__progress-bar--warning': server.memory > 75, 'servers__progress-bar--error': server.memory > 90 }">
                </div>
              </div>
              {{ server.memory | number: '1.0-0' }}%
            </td>
            <td class="servers__cell-metric">
              <div class="servers__progress">
                <div class="servers__progress-bar" [style.width.%]="server.disk"
                  [ngClass]="{ 'servers__progress-bar--warning': server.disk > 80, 'servers__progress-bar--error': server.disk > 95 }">
                </div>
              </div>
              {{ server.disk | number: '1.0-0' }}%
            </td>
            <td class="servers__cell-uptime">
              {{ server.uptime | number: '1.0-0' }} days
            </td>
            <td class="servers__cell-location">
              {{ server.location }}
            </td>
            <td class="servers__cell-actions">
              <button class="servers__btn-action" (click)="editServer(server)" title="Edit">‚úèÔ∏è</button>
              <button class="servers__btn-action servers__btn-action--danger" (click)="deleteServer(server.id)"
                title="Delete">üóëÔ∏è</button>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="8" class="servers__empty">No servers found</td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="servers__pagination">
    <button
      class="servers__btn-page"
      [disabled]="currentPage() === 1"
      (click)="previousPage()">
      ‚Üê Previous
    </button>

    <span class="servers__page-info">
      Page {{ currentPage() }} of {{ totalPages() }}
    </span>

    <button
      class="servers__btn-page"
      [disabled]="currentPage() === totalPages()"
      (click)="nextPage()">
      Next ‚Üí
    </button>
  </div>

  <!-- Modal -->
  @if (showModal()) {
    <div class="servers__modal-overlay" (click)="closeModal()">
      <div class="servers__modal" (click)="$event.stopPropagation()">
        <div class="servers__modal-header">
          <h2>{{ editingServer() ? 'Edit Server' : 'Add Server' }}</h2>
          <button class="servers__modal-close" (click)="closeModal()">‚úï</button>
        </div>

        <form class="servers__form" (ngSubmit)="submitForm()">
          <div class="servers__form-group">
            <label>Server Name *</label>
            <input
              type="text"
              [(ngModel)]="formData.name"
              name="name"
              placeholder="e.g., prod-web-01"
              required />
          </div>

          <div class="servers__form-group">
            <label>IP Address *</label>
            <input
              type="text"
              [(ngModel)]="formData.ip"
              name="ip"
              placeholder="e.g., 192.168.1.100"
              required />
          </div>

          <div class="servers__form-group">
            <label>Operating System *</label>
            <select [(ngModel)]="formData.os" name="os" required>
              <option value="">Select OS</option>
              <option value="Ubuntu 22.04">Ubuntu 22.04</option>
              <option value="Debian 11">Debian 11</option>
              <option value="CentOS 9">CentOS 9</option>
              <option value="Alpine 3.18">Alpine 3.18</option>
            </select>
          </div>

          <div class="servers__form-group">
            <label>Location *</label>
            <select [(ngModel)]="formData.location" name="location" required>
              <option value="">Select Location</option>
              <option value="us-east-1">us-east-1</option>
              <option value="eu-west-1">eu-west-1</option>
              <option value="ap-southeast-1">ap-southeast-1</option>
              <option value="ca-central-1">ca-central-1</option>
              <option value="us-west-2">us-west-2</option>
            </select>
          </div>

          <div class="servers__form-actions">
            <button type="button" class="servers__btn-cancel" (click)="closeModal()">
              Cancel
            </button>
            <button type="submit" class="servers__btn-submit">
              {{ editingServer() ? 'Update' : 'Add' }} Server
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
